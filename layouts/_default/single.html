{{ define "main" }}
<div class="container mx-auto px-6 py-8">
    <article class="prose lg:prose-xl mx-auto max-w-4xl">
        <header class="mb-8">
            {{ if eq .Section "posts" }}
                {{ partial "blog-submenu.html" . }}
            {{ end }}

            {{ if .Params.categories }}
            <div class="post-categories mb-3">
                {{ range $i, $cat := .Params.categories }}
                <a href="/categories/{{ $cat | urlize }}/"
                   class="inline-block text-xs font-bold text-primary uppercase tracking-wider hover:text-primary-dark px-3 py-1 bg-primary-light rounded-full">
                    {{ $cat }}
                </a>
                {{ end }}
            </div>
            {{ end }}

            <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">{{ .Title }}</h1>

            {{ if .Params.description }}
            <p class="text-xl text-gray-700 mb-6 leading-relaxed font-medium">{{ .Params.description }}</p>
            {{ end }}

            <div class="post-meta-detailed flex flex-wrap items-center gap-4 text-sm text-gray-600 pb-6 border-b border-gray-200">
                {{ with .Params.author }}
                <div class="flex items-center gap-2">
                    {{ $authorName := . }}
                    {{ if reflect.IsMap . }}
                        {{ $authorName = .name }}
                    {{ else if reflect.IsSlice . }}
                        {{ $authorName = index . 0 }}
                    {{ end }}
                    <div class="author-avatar w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-semibold">
                        {{ substr $authorName 0 1 | upper }}
                    </div>
                    <div>
                        <div class="text-xs text-gray-500">{{ i18n "author" | default "Author" }}</div>
                        <a href="/authors/{{ $authorName | urlize }}/" class="font-medium text-gray-900 hover:text-primary">{{ $authorName }}</a>
                    </div>
                </div>
                {{ end }}

                <div class="flex items-center gap-2">
                    <svg class="icon text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <div>
                        <div class="text-xs text-gray-500">Published</div>
                        <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" class="font-medium text-gray-900">
                            {{ .Date.Format "January 2, 2006" }}
                        </time>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <svg class="icon text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <div>
                        <div class="text-xs text-gray-500">Reading time</div>
                        <span class="font-medium text-gray-900">{{ .ReadingTime }} min read</span>
                    </div>
                </div>

                {{ with .Lastmod }}
                {{ if gt . $.Date }}
                <div class="flex items-center gap-2">
                    <svg class="icon text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <div>
                        <div class="text-xs text-gray-500">Updated</div>
                        <time datetime="{{ .Format "2006-01-02T15:04:05Z07:00" }}" class="font-medium text-gray-900">
                            {{ .Format "Jan 2, 2006" }}
                        </time>
                    </div>
                </div>
                {{ end }}
                {{ end }}
            </div>

            {{ with .Params.featured_image }}
            <figure class="my-8 -mx-6 md:mx-0">
                <img src="{{ . | absURL }}" alt="{{ $.Title }}" class="w-full rounded-lg shadow-lg">
                <figcaption class="text-center text-sm text-gray-600 mt-3">{{ $.Title }}</figcaption>
            </figure>
            {{ end }}
        </header>

        <!-- Table of Contents for long posts -->
        {{ partial "toc.html" . }}

        <div class="post-content mt-8 text-gray-800 leading-relaxed">
            {{ .Content }}
        </div>

        {{ partial "bibliography.html" . }}
        {{ partial "schema.html" . }}
        {{ if .Site.Params.showVersionsAdmin }}
            {{ partial "versions-admin.html" . }}
        {{ end }}
        {{ partial "taxonomy-admin.html" }}

        <footer class="mt-12 pt-8 border-t border-gray-200">
            {{ if .Params.tags }}
            <div class="mb-8">
                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
                    </svg>
                    Tags
                </h3>
                <div class="flex flex-wrap gap-2">
                    {{ range .Params.tags }}
                    <a href="/tags/{{ . | urlize }}/"
                       data-filter-tag="{{ . }}"
                       class="tag-pill primary text-sm hover:shadow-md transition-all">
                        #{{ . }}
                    </a>
                    {{ end }}
                </div>
            </div>
            {{ end }}

            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 bg-gray-50 rounded-lg p-6">
                <div class="flex-1">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-2">Share this article</h3>
                    {{ partial "share.html" . }}
                </div>

                {{ if .NextInSection }}
                <div class="flex-1">
                    <div class="text-xs text-gray-500 mb-1">Next Article</div>
                    <a href="{{ .NextInSection.RelPermalink }}" class="text-primary hover:text-primary-dark font-medium">
                        {{ .NextInSection.Title }} →
                    </a>
                </div>
                {{ end }}

                {{ if .PrevInSection }}
                <div class="flex-1">
                    <div class="text-xs text-gray-500 mb-1">Previous Article</div>
                    <a href="{{ .PrevInSection.RelPermalink }}" class="text-primary hover:text-primary-dark font-medium">
                        ← {{ .PrevInSection.Title }}
                    </a>
                </div>
                {{ end }}
            </div>
        </footer>
    </article>

    <!-- Related Posts Section (using partial with language filtering) -->
    {{ partial "related-posts.html" . }}
</div>
{{ end }}
